# [기술 문서] Kocom 고가용성 및 옵저버빌리티 아키텍처 (v2.3.0)

이 문서는 v2.3.0 버전에서 강화된 **고가용성(High Availability)** 및 **풀 스택 옵저버빌리티(Full-Stack Observability)** 설계를 다룹니다.

---

### 1. 설계 목표 (Design Goal)

단순한 제어 기능을 넘어, 시스템의 모든 지표를 데이터화하여 다음을 달성합니다.
1.  **AI 분석 최적화:** 로그 데이터만으로 RS485 버스의 혼잡도와 지연 원인을 AI가 추론 가능하게 함.
2.  **선제적 장애 감지:** 큐(Queue) 부하 및 백오프 지연 시간을 모니터링하여 실제 장애 발생 전 징후를 파악함.
3.  **정밀한 트러블슈팅:** 프레이밍 에러 데이터 기록을 통해 특정 하드웨어와의 호환성 문제를 패킷 단위로 분석함.

---

### 2. 레이어별 관측 포인트 (Layered Observability)

#### **2.1 Transport Layer**
*   **Backoff Tracking:** 재연결 시 `min_delay`부터 `max_delay`까지의 단계적 변화를 기록하여 네트워크 복구 탄력성을 측정.
*   **Connection Latency:** 소켓 오픈에 걸리는 시간을 기록하여 공유기/게이트웨이 응답 속도 감시.

#### **2.2 Controller Layer**
*   **Hex-level Framing Log:** 패킷 접두사(Prefix)는 맞지만 접미사(Suffix)가 틀린 경우, 깨진 패킷 전체를 기록하여 노이즈 발생 구간 분석.
*   **State Delta Log:** 상태 변경 시 이전 값과 이후 값을 기록하여 상태 추적의 무결성 보장.

#### **2.3 Gateway Layer**
*   **TX Queue Depth:** 송신 명령 대기열의 길이를 추적하여 명령 처리 능력을 상시 모니터링.
*   **Heartbeat Latency:** 하트비트 패킷의 전송 소요 시간을 밀리초(ms) 단위로 측정하여 버스 유휴 감지 로직의 정확도 개선.

---

### 3. 고가용성(HA) 메트릭 가이드

진단 데이터(JSON)와 로그를 결합하여 다음과 같은 고가용성 지표를 도출할 수 있습니다.

| 지표 | 측정 방법 | 양호 판단 기준 |
| :--- | :--- | :--- |
| **Command Latency** | 로그의 `(소요: X.XXs)` 확인 | < 0.5s |
| **Success Rate** | 시도 횟수 대비 성공률 | > 99% |
| **Queue Saturation** | `TX Queue Depth` 변화 추이 | 평상시 0 유지 |
| **Bus Health** | `Heartbeat Latency` 안정성 | 일정한 소요 시간 유지 |

v2.3.0은 이러한 데이터를 통해 시스템이 스스로 학습하고 최적화될 수 있는 토대를 마련했습니다.
